services:
  # =============================================================
  # MANUAL BRIEFING RUNNER - COSTS MONEY (Claude API)
  # =============================================================
  # Run manually when you want a full analysis:
  #   docker compose run --rm buffett-bot
  #
  # This calls Claude API which costs ~$0.50 per run (10 analyses)
  # Do NOT auto-start this service!
  # =============================================================
  buffett-bot:
    build: .
    container_name: buffett-bot
    restart: "no"  # NEVER auto-restart
    profiles:
      - manual  # Only starts when explicitly requested

    environment:
      - TZ=Europe/Copenhagen

    env_file:
      - .env

    volumes:
      - ./data:/app/data
      - ./config:/app/config:ro

    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M

  # =============================================================
  # BACKGROUND SCHEDULER - FREE (no Claude API calls)
  # =============================================================
  # Start with: docker compose up -d scheduler
  #
  # This runs 24/7 but only does FREE operations:
  # - Weekly stock screening (yfinance - free)
  # - Daily watchlist price checks (yfinance - free)
  #
  # It will NOT run expensive Claude analyses automatically.
  # =============================================================
  scheduler:
    build: .
    container_name: buffett-bot-scheduler
    restart: unless-stopped

    environment:
      - TZ=Europe/Copenhagen

    env_file:
      - .env

    volumes:
      - ./data:/app/data
      - ./config:/app/config:ro

    command: python -m scripts.scheduler

    deploy:
      resources:
        limits:
          memory: 256M

    labels:
      - "com.centurylinklabs.watchtower.enable=false"

# Optional: Add Grafana for dashboards
#  grafana:
#    image: grafana/grafana:latest
#    container_name: buffett-bot-grafana
#    restart: unless-stopped
#    ports:
#      - "3000:3000"
#    volumes:
#      - grafana-data:/var/lib/grafana
#      - ./grafana/dashboards:/etc/grafana/provisioning/dashboards
#    environment:
#      - GF_SECURITY_ADMIN_PASSWORD=admin

volumes:
  grafana-data:
